{% extends "base.html" %}

{% block content %}
<div class="container">
    <!-- Search Section -->
    <section class="search-section">
        <h2>Search Videos</h2>
        <form id="search-form" class="search-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="max_width">Max Width:</label>
                    <input type="number" id="max_width" name="max_width">
                </div>
                <div class="form-group">
                    <label for="max_height">Max Height:</label>
                    <input type="number" id="max_height" name="max_height">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="max_bitrate">Max Bitrate:</label>
                    <input type="text" id="max_bitrate" name="max_bitrate" placeholder="e.g., 1000k">
                </div>
                <div class="form-group">
                    <label for="max_framerate">Max Framerate:</label>
                    <input type="number" id="max_framerate" name="max_framerate" step="0.1">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="codec">Codec:</label>
                    <input type="text" id="codec" name="codec" placeholder="e.g., h264">
                </div>
                <div class="form-group">
                    <label for="path">Path (optional):</label>
                    <input type="text" id="path" name="path" placeholder="Partial path to filter">
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </section>

    <!-- Results Section -->
    <section class="results-section" style="display: none;">
        <h2>Search Results</h2>
        <div class="results-controls">
            <div class="selection-controls">
                <button id="select-all" class="btn btn-secondary">Select All</button>
                <button id="select-none" class="btn btn-secondary">Select None</button>
                <button id="select-invert" class="btn btn-secondary">Invert Selection</button>
            </div>
            <button id="convert-videos" class="btn btn-primary">Convert Selected Videos</button>
        </div>
        
        <!-- Pagination Above Table -->
        <div class="pagination-controls top-pagination">
            <div class="pagination-left">
                <select id="page-size-top">
                    <option value="50">50 per page</option>
                    <option value="100">100 per page</option>
                    <option value="250">250 per page</option>
                    <option value="500">500 per page</option>
                    <option value="1000">1000 per page</option>
                    <option value="all">All results</option>
                </select>
                <span id="results-count-top" class="results-count"></span>
            </div>
            
            <div class="pagination-center">
                <button id="first-page-top" class="btn btn-secondary pagination-btn" title="First Page">«</button>
                <button id="prev-page-top" class="btn btn-secondary pagination-btn" title="Previous Page">‹</button>
                
                <div class="page-input-container">
                    <span>Page</span>
                    <input type="number" id="page-input-top" min="1" value="1" class="page-input">
                    <span id="total-pages-top">of 1</span>
                </div>
                
                <button id="next-page-top" class="btn btn-secondary pagination-btn" title="Next Page">›</button>
                <button id="last-page-top" class="btn btn-secondary pagination-btn" title="Last Page">»</button>
            </div>
            
            <div class="pagination-right">
                <span id="page-info-top">Page 1 of 1</span>
            </div>
        </div>

        <div class="table-container">
            <table id="results-table" class="data-table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="select-all-checkbox"></th>
                        <th data-sort-original="title">Title</th>
                        <th data-sort-original="duration">Duration</th>
                        <th data-sort-original="size">File Size</th>
                        <th data-sort-original="codec">Codec</th>
                        <th data-sort-original="width">Width</th>
                        <th data-sort-original="height">Height</th>
                        <th data-sort-original="bitrate">Bitrate</th>
                        <th data-sort-original="framerate">FPS</th>
                        <th>Path</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Pagination Below Table (existing, updated) -->
        <div class="pagination-controls bottom-pagination">
            <div class="pagination-left">
                <select id="page-size-bottom">
                    <option value="50">50 per page</option>
                    <option value="100">100 per page</option>
                    <option value="250">250 per page</option>
                    <option value="500">500 per page</option>
                    <option value="1000">1000 per page</option>
                    <option value="all">All results</option>
                </select>
                <span id="results-count-bottom" class="results-count"></span>
            </div>

            <div class="pagination-center">
                <button id="first-page-bottom" class="btn btn-secondary pagination-btn" title="First Page">«</button>
                <button id="prev-page-bottom" class="btn btn-secondary pagination-btn" title="Previous Page">‹</button>

                <div class="page-input-container">
                    <span>Page</span>
                    <input type="number" id="page-input-bottom" min="1" value="1" class="page-input">
                    <span id="total-pages-bottom">of 1</span>
                </div>

                <button id="next-page-bottom" class="btn btn-secondary pagination-btn" title="Next Page">›</button>
                <button id="last-page-bottom" class="btn btn-secondary pagination-btn" title="Last Page">»</button>
            </div>

            <div class="pagination-right">
                <span id="page-info-bottom">Page 1 of 1</span>
            </div>
        </div>
    </section>

    <!-- Conversion Section -->
    <section class="conversion-section" style="display: none;">
        <h2>Conversion Queue</h2>
        <div class="conversion-controls">
            <button id="cancel-all" class="btn btn-danger">Cancel All</button>
            <button id="clear-completed" class="btn btn-secondary">Clear Completed</button>
        </div>

        <div class="progress-overview">
            <div class="progress-bar">
                <div id="overall-progress" class="progress-fill"></div>
            </div>
            <div id="progress-text">0% Complete</div>
            <div id="eta-text">ETA: Calculating...</div>
        </div>

        <div class="table-container">
            <table id="conversion-table" class="data-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Progress</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </section>
</div>

<!-- Log Modal -->
<div id="log-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Conversion Log</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <pre id="log-content"></pre>
        </div>
    </div>
</div>

<script>
    // Show settings modal on first run
    document.addEventListener('DOMContentLoaded', function() {
        const showSettings = document.body.getAttribute('data-show-settings') === 'true';
        if (showSettings) {
            setTimeout(() => {
                if (typeof app !== 'undefined') {
                    app.showSettingsModal();
                }
            }, 500);
        }
    });
</script>
{% endblock %}
